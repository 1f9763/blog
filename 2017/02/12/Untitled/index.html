<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <meta name="renderer" content="webkit">
  <meta http-equiv="X-UA-Compatible" content="IE=edge" >
  <link rel="dns-prefetch" href="maida.me">
  <title>PM 叫你去改一个 Bug，后来…… | dakara</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="你曾经碰到过现在这种情况：
你的代码非常优雅。你代码中的抽象刚刚好，不多不少。你的模块都各自独立。所有的测试结果都是绿色的。代码测试覆盖率报告花了整整一分钟才打开，上面显示着 97%……
生活很美好。
然后事情就这么发生了。
一个 PM（产品经理）跑进来，跟你说上周你发布的那个更新里面有个 bug。不论什么时候，只要用户在购物车里添加了一件商品，购物车中的计数过个好几秒才会更新。本来应该立即更新的">
<meta property="og:type" content="article">
<meta property="og:title" content="PM 叫你去改一个 Bug，后来……">
<meta property="og:url" content="maida.me/2017/02/12/Untitled/index.html">
<meta property="og:site_name" content="dakara">
<meta property="og:description" content="你曾经碰到过现在这种情况：
你的代码非常优雅。你代码中的抽象刚刚好，不多不少。你的模块都各自独立。所有的测试结果都是绿色的。代码测试覆盖率报告花了整整一分钟才打开，上面显示着 97%……
生活很美好。
然后事情就这么发生了。
一个 PM（产品经理）跑进来，跟你说上周你发布的那个更新里面有个 bug。不论什么时候，只要用户在购物车里添加了一件商品，购物车中的计数过个好几秒才会更新。本来应该立即更新的">
<meta property="og:updated_time" content="2017-02-12T12:49:40.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="PM 叫你去改一个 Bug，后来……">
<meta name="twitter:description" content="你曾经碰到过现在这种情况：
你的代码非常优雅。你代码中的抽象刚刚好，不多不少。你的模块都各自独立。所有的测试结果都是绿色的。代码测试覆盖率报告花了整整一分钟才打开，上面显示着 97%……
生活很美好。
然后事情就这么发生了。
一个 PM（产品经理）跑进来，跟你说上周你发布的那个更新里面有个 bug。不论什么时候，只要用户在购物车里添加了一件商品，购物车中的计数过个好几秒才会更新。本来应该立即更新的">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link rel="stylesheet" href="/main.css">
  

</head>

<body>
  <div id="container">
    <div class="left-col">
      <div class="overlay"></div>
<div class="intrude-less">
	<header id="header" class="inner">
		<a href="/" class="profilepic">
			
			<img src="/img/pb.jpg" class="js-avatar">
			
		</a>

		<hgroup>
		  <h1 class="header-author"><a href="/">Nick Pang</a></h1>
		</hgroup>

		
		<p class="header-subtitle">读书 编程 自律 心智成熟</p>
		

		<nav class="header-menu">
			<ul>
			
			</ul>
		</nav>
		<nav class="header-smart-menu">
	        
    		
		</nav>
		<nav class="header-nav">
			<div class="social">
				
					<a class="github" target="_blank" href="https://github.com/1f9763" title="github">github</a>
		        
					<a class="rss" target="_blank" href="http://www.jianshu.com/users/d91539be677c" title="rss">rss</a>
		        
					<a class="douban" target="_blank" href="https://www.douban.com/people/75364739/" title="douban">douban</a>
		        
			</div>
		</nav>
	</header>		
</div>

    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
  	<div class="overlay">
  		<div class="slider-trigger"><i class="icon-list"></i></div>
  		<h1 class="header-author js-mobile-header hide">Nick Pang</h1>
  	</div>
	<div class="intrude-less">
		<header id="header" class="inner">
			<div class="profilepic">
				
					<img src="/img/pb.jpg" class="js-avatar">
				
			</div>
			<hgroup>
			  <h1 class="header-author">Nick Pang</h1>
			</hgroup>
			
			<p class="header-subtitle">读书 编程 自律 心智成熟</p>
			
			<nav class="header-menu">
				<ul>
				
				</ul>
			</nav>
			<nav class="header-nav">
				<div class="social">
					
						<a class="github" target="_blank" href="https://github.com/1f9763" title="github">github</a>
			        
						<a class="rss" target="_blank" href="http://www.jianshu.com/users/d91539be677c" title="rss">rss</a>
			        
						<a class="douban" target="_blank" href="https://www.douban.com/people/75364739/" title="douban">douban</a>
			        
				</div>
			</nav>
		</header>				
	</div>
</nav>

      <div class="body-wrap">
        <article id="post-Untitled" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      PM 叫你去改一个 Bug，后来……
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>你曾经碰到过现在这种情况：</p>
<p>你的代码非常优雅。<br>你代码中的抽象刚刚好，不多不少。<br>你的模块都各自独立。<br>所有的测试结果都是绿色的。代码测试覆盖率报告花了整整一分钟才打开，上面显示着 97%……</p>
<p>生活很美好。</p>
<p>然后事情就这么发生了。</p>
<p>一个 PM（产品经理）跑进来，跟你说上周你发布的那个更新里面有个 bug。不论什么时候，只要用户在购物车里添加了一件商品，购物车中的计数过个好几秒才会更新。本来应该立即更新的。</p>
<p>PM 跟你说用户的抱怨如潮水般用来，他问你：你能看一眼么？<br><a id="more"></a></p>
<p>当然你能看一眼，毕竟这是你做的东西。很可能是其他什么人犯了错。不过你会修复这个问题的。你就是这么正直的员工。</p>
<p>你在 Git 上把最新的发布版本同步下来，然后开始研究变更日志。在上一个发布版本中，你把 HTTP request 库更新到了最新版。那次审核过了好长的时间。你还能记得这次修改确切的提交所在，那天的天气不错。</p>
<p>你切换到那次提交，然后模拟了一下更新购物车的请求。不错 ，你已经充分考虑到了代码的独立性，可以很容易地在测试环境和生产环境中进行测试，只需要切换一个构建标记就够了。</p>
<p>你找到了那个罪魁祸首。看起来你更新的那个 HTTP 库有个回归（regression）。对于特定类型的请求，它花了太长的时间来解析传入的 JSON 负载。你的应用只能在请求负载解析完成之后才能更新那个计数器。在架构上还没有处理最终一致性的问题，要加上这种设计的话，本身就足够当成一个项目来做了。所以你没法在本地先更新计数器随后再同步到服务器上。</p>
<p>你知道这是别人犯的错。唉，这就是生活。</p>
<p>你把事情的原因告诉了 PM。他拍了拍你的背，知道这不怪你。你能把这个问题修复么？</p>
<p>当然。</p>
<p>你已经考虑好你的解决办法。</p>
<p>你不能把变更都回滚。有一大堆新的代码和 bug 的修复都依赖于这个新版的库，要是你把所有东西都回滚的话，这些就都白干了。</p>
<p>只是把这个库 fork 下来然后维护一个你自己的版本看上去也不太可行。之前这个项目的维护者有一个超级完备的测试架构，会在上千台设备上测试你修复的代码。而你只有三台设备，其中两个的操作系统版本都老掉牙了。最好还是需要他们的反馈，毕竟这是他们维护的库，他们对其内部结构很了解，而你不了解。</p>
<p>所以你打算这么干：</p>
<p>Fork 这个库<br>实现代码修复<br>向原始的 repo 中发一个 pull request<br>你和维护者可能需要来回几次沟通<br>最终说服他们相信你的方法才是最好的<br>代码合并<br>等着这个库发布一个新的补丁<br>在你的代码中更新这个库<br>发布产品的新版本</p>
<p>很简单嘛。</p>
<p>“好极了，”PM 说，“你觉得需要花多长时间？”</p>
<p>你知道这个答案。人们都说程序员不会估算时间，你可不是那种程序员。（《为什么软件开发周期通常是预期的两三倍？》）</p>
<p>“两周，”你眼都不眨地说，“取决于这个 PR 多久才会被接受，还有维护的人多快能发布一个新版本。”</p>
<p>PM 的脸色立刻就变绿了。“两周？两周？！”他重复着同样的话，好像这样能改变一样。不过他还是保持了冷静。PM 知道怎么处理负面的情绪，没什么可担心的。</p>
<p>“我们的用户正在流失！他们什么都不会买了，因为他们没法看到自己购物车里面的更新！我们是个电商公司！这是不可接受的！”</p>
<p>你看着他经历着悲伤的五个阶段（译注：否认、愤怒、讨价还价、绝望、接受）。你等着最后接受的那个过程什么时候会发生。不过并没有。他看起来停在了讨价还价的阶段。</p>
<p>“好吧，”你说着，深陷在你的转椅里，“让我想想。”</p>
<p>你会迁就他一下下，然后他可能就会离开了。你还有很多其他事情要做，你知道的。</p>
<p>你开始翻看源代码。这是你的特长，你的手指敲击着 IDE 的快捷键，就好像海神波塞冬驾驭着大海的波涛。</p>
<p>啊哈！你找到它了！有个文档中没提到的方法，可以在 JSON 解析的代码中插入一个钩子，然后用你自己的实现来替换它！</p>
<p>不过等等。这看起来太丑陋了。这可是个非公开的 API，说不定把它暴露出来是个意外呢。你可不想依赖这种东西，万一他们在下一个版本里把它移除掉了怎么办？那样你就得把这套东西整个都重写一遍了。谁想这么干啊？不过这确实比自己维护一个没测试过的分支要快一些。不过还是太丑陋了。</p>
<p>不要。</p>
<p>你可不想因为商务决策而误导你，毁了你纯净的神殿。你是神圣的守护者，对抗着那些愚昧的事物。这就是为什么他们会付你那么多钱的原因。你的责任就是拒绝这种要求。</p>
<p>你冲进 PM 的屋子。“答案是不要。没有什么优雅的方法来解决它，我不相信丑陋的旁门左道。抱歉。”</p>
<p>他的反应和你预料中的一样。</p>
<p>“你告诉我有个方法可以做到，不过你不想这么做就因为它不够优雅？我们的用户正冲我们叫嚣着，威胁我们要改用我们竞争对手地产品，而你就不愿意修复这个问题，就因为它不够优雅？“</p>
<p>你失败了。</p>
<p>这人懂什么软件工程？你只用代码就凭空创建了这个奇妙的世界。高度可扩展的系统，可以抵抗住来自前苏联集团中所有黑客发向你的 DDoS 攻击。你是个艺术家，而芯片就是你的画布。你已经无数次地阅读了《代码整洁之道》，你对它的了解甚至超过了你对自己 GitHub 密码的印象。</p>
<p>“没错！”你喊道，“我不会用这种垃圾来玷污我们的代码库！我花了好几个月才构建出这些东西！产品里的每一行代码都是我的心血！它们能够正常运行的唯一原因不是你，和你没关系！是像我这样的人们维持着软件的运行，是像我这样的人们，不得不在你和你的那些‘商业功能’完成之后去清理那些乱七八糟的东西！”</p>
<p>你冲出了那儿。你需要喝点什么。这样的人简直就是业界的祸根。他们觉得自己那些花哨的 MBA 证书能让他们知道该如何创造出伟大的软件，而我们这些开发者却不知为什么忽略了这种方法。</p>
<p>你昂首阔步地走进休息区，那是你每天享用那些美食家们推荐的午餐的地方。还有咖啡，不限量的、美味的、滋润着你的灵魂的咖啡。你值得这种享受，因为你是个知识工作者。</p>
<p>你冲了一杯 java 咖啡，想找个地方坐下。</p>
<p>然后你看到了他。</p>
<p>你的公司中最资深的程序员。</p>
<p>这家伙是个彻头彻尾的核心人员，是那种“我在上厕所的工夫就能写出一个编译器”的程序员。在黑客出现之前他就已经是名黑客了。你想要成为这样的人。他就像是指环王里面的甘道夫。这里所有人在所有时候都尊敬和畏惧着他。不过他很和蔼，总是会帮助那些孩子们。他应该愿意听听你和 PM 之间发生的事情。毕竟，他是你这一伙的。</p>
<p>于是你坐到他旁边。他正享受着咖啡，正在看着什么 Haskell 中抽象的数据类型之类的东西。</p>
<p>没错，就得和这样的人聊聊。</p>
<p>你把自己的壮举告诉了他。他耐心地听着，偶尔点点头，问了些问题。他的肢体语言是向后靠着。从他的眼神中你能看得出来，他以前也经历过这种事儿。</p>
<p>你终于说完了。</p>
<p>好累。</p>
<p>你感觉肩上的分量轻了一些。</p>
<p>他看上去陷入了沉思，好像正在谨慎地选择着词汇。</p>
<p>你等着他会大笑着宣布“干的好，孩子！”，然后你们会一起再冲杯咖啡。他会给你讲一个他所经历过的类似的故事，在那一天，他如何斥责一个愚蠢的 PM。</p>
<p>你曾经梦想过这一天。你们会用咖啡碰杯，就像那些在战场上取胜的战士那样。至少，在电影里他们是那么干的。当然，他们通常用的是啤酒，而不是咖啡。</p>
<p>在感情上，你是这么希望的。</p>
<p>你等待着……</p>
<p>继续等待着……</p>
<p>他直直地看向你的双眼，穿透了你的灵魂。那些和电脑一起奋斗过的岁月让他的目光变得如此难以忍受，不过他使用了什么魔法，让你无法移开你的眼睛。</p>
<p>他只说了一件事。</p>
<p><strong>“我们的工作并不是喝喝咖啡敲敲代码。我们的工作是编写能够正常运行的软件。”</strong></p>
<p>然后他就走开了。</p>
<p>你呆住了一分钟。在你肚子里有种什么感觉，一种空荡荡的、恶心的感觉。你开始意识到这种感觉，叫做羞愧。</p>
<p>你让那些你最亏欠的人失望了，那就是你的用户。</p>
<p>于是你回到自己的座位上，迅速搞定了那个“旁门左道”，然后发布了一个新的版本。</p>
<p>你向 PM 道了歉，自己有点失控了。他说没事。最后只要没事就好。</p>
<p>你还是 fork 了这个库，实现了一个正确的修复方式，然后提交了一个 PR。当这个库以正确的解决方法发布新版本的时候，你总是可以重构自己的代码的。</p>
<blockquote>
<p>译文：伯乐在线专栏作者 - Erucy<br>英文：Anup Cowkur<br>link：<a href="http://blog.jobbole.com/105832/" target="_blank" rel="external">http://blog.jobbole.com/105832/</a></p>
</blockquote>

      
    </div>
    <div class="article-info article-info-index">
      
      <a href="/2017/02/12/Untitled/" class="archive-article-date">
  	<time datetime="2017-02-12T12:30:00.000Z" itemprop="datePublished"><i class="icon-clock"></i>2017-02-12</time>
</a>
      
	<div class="article-tag tagcloud">
		<!--<i class="icon-price-tags"></i>-->
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/PM/">PM</a></li></ul>
	</div>


      

      <div class="clearfix"></div>
    </div>
  </div>
</article>

  
<nav id="article-nav">
  
    <a href="/2017/02/14/Transformation/" id="article-nav-newer" class="article-nav-link-wrap">
      <i class="icon-circle-left"></i>
      <div class="article-nav-title">
        
          Transformation
        
      </div>
    </a>
  
  
    <a href="/2017/02/05/Bayes-theorem/" id="article-nav-older" class="article-nav-link-wrap">
      <div class="article-nav-title">Bayes theorem</div>
      <i class="icon-circle-right"></i>
    </a>
  
</nav>




<div class="share_jia">
	<!-- JiaThis Button BEGIN -->
	<div class="jiathis_style">
		<span class="jiathis_txt">Share to: &nbsp; </span>
		<a class="jiathis_button_facebook"></a> 
	    <a class="jiathis_button_twitter"></a>
	    <a class="jiathis_button_plus"></a> 
	    <a class="jiathis_button_tsina"></a>
		<a class="jiathis_button_cqq"></a>
		<a class="jiathis_button_douban"></a>
		<a class="jiathis_button_weixin"></a>
		<a class="jiathis_button_tumblr"></a>
    <a href="http://www.jiathis.com/share" class="jiathis jiathis_txt jtico jtico_jiathis" target="_blank"></a>
	</div>
	<script type="text/javascript" src="//v3.jiathis.com/code/jia.js?uid=1405949716054953" charset="utf-8"></script>
	<!-- JiaThis Button END -->
</div>






<div class="duoshuo">
	<!-- 多说评论框 start -->
	<div class="ds-thread" data-thread-key="Untitled" data-title="PM 叫你去改一个 Bug，后来……" data-url="maida.me/2017/02/12/Untitled/"></div>
	<!-- 多说评论框 end -->
	<!-- 多说公共JS代码 start (一个网页只需插入一次) -->
	<script type="text/javascript">
	var duoshuoQuery = {short_name:"dakara"};
	(function() {
		var ds = document.createElement('script');
		ds.type = 'text/javascript';ds.async = true;
		ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
		ds.charset = 'UTF-8';
		(document.getElementsByTagName('head')[0] 
		 || document.getElementsByTagName('body')[0]).appendChild(ds);
	})();
	</script>
	<!-- 多说公共JS代码 end -->
</div>





      </div>
      <footer id="footer">
  <div class="outer">
    <div id="footer-info">
    	<div class="footer-left">
    		&copy; 2017 Nick Pang
    	</div>
       
    </div>
  </div>
</footer>
    </div>
    <script>
	var yiliaConfig = {
		fancybox: true,
		mathjax: false,
		animate: true,
		isHome: false,
		isPost: true,
		isArchive: false,
		isTag: false,
		isCategory: false,
		open_in_new: false,
		root: "/",
		innerArchive: false
	}
</script>

<script src="/./main.js"></script>


    
<div class="tools-col">

  <ul class="btn-wrap">
    
    
    
    
  </ul>

  <div class="tools-wrap">
    

    

    

    
  </div>
  
</div>
    <!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    <!-- Background of PhotoSwipe. 
         It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>

    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">

        <!-- Container that holds slides. 
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                <!--  Controls are self-explanatory. Order can be changed. -->

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" style="display:none" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                <!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR -->
                <!-- element will get class pswp__preloader--active when preloader is running -->
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                      <div class="pswp__preloader__cut">
                        <div class="pswp__preloader__donut"></div>
                      </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div> 
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div>
  </div>
</body>
</html>